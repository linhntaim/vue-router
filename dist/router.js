"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _session=require("./session");var _middleware=require("./middleware");var _vueRouter=_interopRequireDefault(require("vue-router"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var Router=/*#__PURE__*/function(_VueRouter){_inherits(Router,_VueRouter);var _super=_createSuper(Router);function Router(){var _this;var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Router);_this=_super.call(this,options);_this.routePathByNames={};_this.beforeDefault=_this.options.beforeDefault?_this.options.beforeDefault:[];_this.beforeRouting=_this.options.beforeRouting?_this.options.beforeRouting:null;_this.beforeEnabled=_this.options.beforeEnabled?_this.options.beforeEnabled:function(){return true};_this.afterDefault=_this.options.afterDefault?_this.options.afterDefault:[];_this.afterRouting=_this.options.afterRouting?_this.options.afterRouting:null;_this.afterEnabled=_this.options.afterEnabled?_this.options.afterEnabled:function(){return true};_this.authRoutes=_this.options.authRoutes?_this.options.authRoutes:null;_this.notAuthRoutes=_this.options.notAuthRoutes?_this.options.notAuthRoutes:null;delete _this.options.beforeDefault;delete _this.options.beforeRouting;delete _this.options.beforeEnabled;delete _this.options.afterDefault;delete _this.options.afterRouting;delete _this.options.afterEnabled;delete _this.options.authRoutes;delete _this.options.notAuthRoutes;_this.parseRoutes();_this.beforeEach(function(to,from,next){_this.beforeRouting&&_this.beforeRouting(to,from);if(_this.beforeEnabled(to,from)&&!_session.session.skipping()){var middlewareGroups=_this.beforeDefault.slice(0);to.matched.forEach(function(route){if("middleware"in route.meta){var add=function add(middleware){if(middleware instanceof _middleware.Middleware){middlewareGroups.push(middleware);return}if(Array.isArray(middleware)){middleware.forEach(function(subMiddleware){return add(subMiddleware)});return}if("before"in middleware){add(middleware.before)}};add(route.meta.middleware)}});if(middlewareGroups.length){new _middleware.BeforeMiddlewareManager(middlewareGroups,_assertThisInitialized(_this)).run(to,from,next);return}}next()});_this.afterEach(function(to,from){if(_this.afterEnabled(to,from)&&!_session.session.skipping()){var middlewareGroups=[];to.matched.forEach(function(route){if("middleware"in route.meta){var add=function add(middleware){if(middleware instanceof _middleware.Middleware){middlewareGroups.push(middleware);return}if(Array.isArray(middleware)){middleware.forEach(function(subMiddleware){return add(subMiddleware)});return}if("after"in middleware){add(middleware.after)}};add(route.meta.middleware)}});middlewareGroups.push.apply(middlewareGroups,_toConsumableArray(_this.afterDefault.slice(0)));if(middlewareGroups.length){new _middleware.AfterMiddlewareManager(middlewareGroups,_assertThisInitialized(_this)).run(to,from)}}_session.session.skipping()&&_session.session.abortSkipping();_this.afterRouting&&_this.afterRouting(to,from)});return _this}_createClass(Router,[{key:"parseRoute",value:function parseRoute(route){var _this2=this;var parentPath=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var routePath="/"+(parentPath+"/"+route.path).replace(/\/+/g,"/").replace(/^\/|\/$/g,"");if(route.name){this.routePathByNames[route.name]=routePath}route.children&&route.children.length&&route.children.forEach(function(childRoute){_this2.parseRoute(childRoute,routePath)})}},{key:"parseRoutes",value:function parseRoutes(){var _this3=this;this.routePathByNames={};this.options.routes.forEach(function(route){_this3.parseRoute(route)})}},{key:"getPathByName",value:function getPathByName(name){return name in this.routePathByNames?this.routePathByNames[name]:null}},{key:"replaceRoutes",value:function replaceRoutes(routes){this.options.routes=routes;this.matcher=new Router(this.options).matcher;this.parseRoutes();return this}},{key:"switchToAuth",value:function switchToAuth(){if(this.authRoutes){this.replaceRoutes(this.authRoutes);return true}return false}},{key:"switchToNotAuth",value:function switchToNotAuth(){if(this.notAuthRoutes){this.replaceRoutes(this.notAuthRoutes);return true}return false}},{key:"softReplace",value:function softReplace(location){var onComplete=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var onAbort=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;_session.session.skip();this.replace(location,onComplete,function(){onAbort&&onAbort()})}},{key:"catchSoftReplace",value:function catchSoftReplace(location){var onComplete=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var onAbort=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;_session.session.skip();return this.replace(location,onComplete,onAbort)}}]);return Router}(_vueRouter["default"]);exports["default"]=Router;
//# sourceMappingURL=router.js.map