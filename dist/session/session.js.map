{"version":3,"sources":["../../src/session/session.js"],"names":["Session","storeHandler","accessTime","nextAccessTime","data","sync","action","setJson","getJson","key","value","store","flash","def"],"mappings":"utBAAqBA,CAAAA,O,yBACjB,kBAAc,+BACV,KAAKC,YAAL,CAAoB,IAApB,CACA,KAAKC,UAAL,CAAkB,CAAlB,CACA,KAAKC,cAAL,CAAsB,CAAtB,CAEA,KAAKC,IAAL,CAAY,EACf,CAED;;;yFAImBH,Y,CAAc,CAC7B,KAAKA,YAAL,CAAoBA,YAApB,CACA,KAAKI,IAAL,CAAU,MAAV,EACA,MAAO,KACV,CAED;;;iEAIiBJ,Y,CAAc,CAC3B,KAAKA,YAAL,CAAoBA,YAApB,CACA,KAAKI,IAAL,GACA,MAAO,KACV,CAED;;;0CAIoB,IAAfC,CAAAA,MAAe,2DAAN,IAAM,CAChB,GAAI,CAAC,KAAKL,YAAV,CAAwB,OAExB,GAAIK,MAAM,GAAK,MAAf,CAAuB,CACnB,KAAKL,YAAL,CAAkBM,OAAlB,CAA0B,WAA1B,CAAuC,KAAKH,IAA5C,CACH,CAFD,IAEO,CACH,GAAMA,CAAAA,IAAI,CAAG,KAAKH,YAAL,CAAkBO,OAAlB,CAA0B,WAA1B,CAAb,CACA,GAAIJ,IAAJ,CAAU,KAAKA,IAAL,CAAYA,IACzB,CACJ,C,qCAEO,CACJ,KAAKD,cAAL,CAAsB,EAAE,KAAKD,UAAP,CAAoB,CAA1C,CACA,MAAO,KACV,C,yCAES,CACN,KAAKA,UAAL,CAAkB,CAAlB,CACA,KAAKC,cAAL,CAAsB,CAAtB,CACA,MAAO,KACV,C,mCAEM,CACH,KAAKA,cAAL,CAAsB,KAAKD,UAA3B,CACA,MAAO,KACV,C,qDAEe,CACZ,KAAKC,cAAL,CAAsB,KAAKD,UAAL,CAAkB,CAAxC,CACA,MAAO,KACV,C,2CAEU,CACP,MAAO,MAAKC,cAAL,EAAuB,KAAKD,UACtC,C,yCAES,CACN,MAAO,MAAKA,UAAL,GAAoB,CAC9B,C,+CAEY,CACT,MAAO,MAAKA,UAAL,CAAkB,CAC5B,C,oCAEKO,G,CAAKC,K,CAAO,CACd,MAAO,MAAKC,KAAL,CAAWF,GAAX,CAAgBC,KAAhB,CAAuB,IAAvB,CACV,C,oCAEKD,G,CAAKC,K,CAAsB,IAAfE,CAAAA,KAAe,2DAAP,KAAO,CAC7B,KAAKR,IAAL,CAAUK,GAAV,EAAiB,CACbC,KAAK,CAAEA,KADM,CAEbE,KAAK,CAAEA,KAFM,CAAjB,CAIA,KAAKP,IAAL,CAAU,MAAV,EACA,MAAO,KACV,C,0CAEQI,G,CAAiB,IAAZI,CAAAA,GAAY,2DAAN,IAAM,CACtB,GAAI,EAAEJ,GAAG,GAAI,MAAKL,IAAd,CAAJ,CAAyB,MAAOS,CAAAA,GAAP,CAEzB,GAAMT,CAAAA,IAAI,CAAG,KAAKA,IAAL,CAAUK,GAAV,CAAb,CACA,GAAIL,IAAI,CAACQ,KAAT,CAAgB,CACZ,MAAO,MAAKR,IAAL,CAAUK,GAAV,CACV,CACD,MAAOL,CAAAA,IAAI,CAACM,KACf,C","sourcesContent":["export default class Session {\r\n    constructor() {\r\n        this.storeHandler = null\r\n        this.accessTime = 0\r\n        this.nextAccessTime = 1\r\n\r\n        this.data = {}\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {StoreHandler} storeHandler\r\n     */\r\n    attachStoreHandler(storeHandler) {\r\n        this.storeHandler = storeHandler\r\n        this.sync('save')\r\n        return this\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {StoreHandler} storeHandler\r\n     */\r\n    fromStoreHandler(storeHandler) {\r\n        this.storeHandler = storeHandler\r\n        this.sync()\r\n        return this\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {String|null} action\r\n     */\r\n    sync(action = null) {\r\n        if (!this.storeHandler) return\r\n\r\n        if (action === 'save') {\r\n            this.storeHandler.setJson('__session', this.data)\r\n        } else {\r\n            const data = this.storeHandler.getJson('__session')\r\n            if (data) this.data = data\r\n        }\r\n    }\r\n\r\n    start() {\r\n        this.nextAccessTime = ++this.accessTime + 1\r\n        return this\r\n    }\r\n\r\n    restart() {\r\n        this.accessTime = 1\r\n        this.nextAccessTime = 2\r\n        return this\r\n    }\r\n\r\n    skip() {\r\n        this.nextAccessTime = this.accessTime\r\n        return this\r\n    }\r\n\r\n    abortSkipping() {\r\n        this.nextAccessTime = this.accessTime + 1\r\n        return this\r\n    }\r\n\r\n    skipping() {\r\n        return this.nextAccessTime <= this.accessTime\r\n    }\r\n\r\n    isFresh() {\r\n        return this.accessTime === 1\r\n    }\r\n\r\n    isNotFresh() {\r\n        return this.accessTime > 1\r\n    }\r\n\r\n    flash(key, value) {\r\n        return this.store(key, value, true)\r\n    }\r\n\r\n    store(key, value, flash = false) {\r\n        this.data[key] = {\r\n            value: value,\r\n            flash: flash,\r\n        }\r\n        this.sync('save')\r\n        return this\r\n    }\r\n\r\n    retrieve(key, def = null) {\r\n        if (!(key in this.data)) return def\r\n\r\n        const data = this.data[key]\r\n        if (data.flash) {\r\n            delete this.data[key]\r\n        }\r\n        return data.value\r\n    }\r\n}\r\n"],"file":"session.js"}