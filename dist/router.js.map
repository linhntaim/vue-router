{"version":3,"sources":["../src/router.js"],"names":["Router","options","routePathByNames","beforeDefault","beforeRouting","beforeEnabled","afterDefault","afterRouting","afterEnabled","authRoutes","notAuthRoutes","parseRoutes","beforeEach","to","from","next","session","skipping","middlewareGroups","slice","matched","forEach","route","meta","add","middleware","Middleware","push","Array","isArray","subMiddleware","before","length","BeforeMiddlewareManager","run","afterEach","after","AfterMiddlewareManager","abortSkipping","parentPath","routePath","path","replace","name","children","childRoute","parseRoute","routes","matcher","replaceRoutes","location","onComplete","onAbort","sessionSkipped","skip","smoothReplace","smoothPush","VueRouter"],"mappings":"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","sourcesContent":["import {session} from './session'\r\nimport {AfterMiddlewareManager, BeforeMiddlewareManager, Middleware} from './middleware'\r\nimport VueRouter from 'vue-router'\r\n\r\nexport default class Router extends VueRouter {\r\n    constructor(options = {}) {\r\n        super(options)\r\n\r\n        this.routePathByNames = {}\r\n\r\n        this.beforeDefault = 'beforeDefault' in this.options ? this.options.beforeDefault : []\r\n        this.beforeRouting = 'beforeRouting' in this.options ? this.options.beforeRouting : null\r\n        this.beforeEnabled = 'beforeEnabled' in this.options ? this.options.beforeEnabled : () => true\r\n        this.afterDefault = 'afterDefault' in this.options ? this.options.afterDefault : []\r\n        this.afterRouting = 'afterRouting' in this.options ? this.options.afterRouting : null\r\n        this.afterEnabled = 'afterEnabled' in this.options ? this.options.afterEnabled : () => true\r\n        this.authRoutes = 'authRoutes' in this.options ? this.options.authRoutes : null\r\n        this.notAuthRoutes = 'notAuthRoutes' in this.options ? this.options.notAuthRoutes : null\r\n\r\n        'beforeDefault' in this.options && delete this.options.beforeDefault\r\n        'beforeRouting' in this.options && delete this.options.beforeRouting\r\n        'beforeEnabled' in this.options && delete this.options.beforeEnabled\r\n        'afterDefault' in this.options && delete this.options.afterDefault\r\n        'afterRouting' in this.options && delete this.options.afterRouting\r\n        'afterEnabled' in this.options && delete this.options.afterEnabled\r\n        'authRoutes' in this.options && delete this.options.authRoutes\r\n        'notAuthRoutes' in this.options && delete this.options.notAuthRoutes\r\n\r\n        this.parseRoutes()\r\n\r\n        this.beforeEach((to, from, next) => {\r\n            this.beforeRouting && this.beforeRouting(to, from)\r\n\r\n            if (this.beforeEnabled(to, from) && !session.skipping()) {\r\n                const middlewareGroups = this.beforeDefault.slice(0)\r\n                to.matched.forEach(route => {\r\n                    if ('middleware' in route.meta) {\r\n                        const add = middleware => {\r\n                            if (middleware instanceof Middleware) {\r\n                                middlewareGroups.push(middleware)\r\n                                return\r\n                            }\r\n                            if (Array.isArray(middleware)) {\r\n                                middleware.forEach(subMiddleware => add(subMiddleware))\r\n                                return\r\n                            }\r\n                            if ('before' in middleware) {\r\n                                add(middleware.before)\r\n                            }\r\n                        }\r\n                        add(route.meta.middleware)\r\n                    }\r\n                })\r\n\r\n                if (middlewareGroups.length) {\r\n                    (new BeforeMiddlewareManager(middlewareGroups, this)).run(to, from, next)\r\n                    return\r\n                }\r\n            }\r\n\r\n            next()\r\n        })\r\n\r\n        this.afterEach((to, from) => {\r\n            if (this.afterEnabled(to, from) && !session.skipping()) {\r\n                const middlewareGroups = []\r\n                to.matched.forEach(route => {\r\n                    if ('middleware' in route.meta) {\r\n                        const add = middleware => {\r\n                            if (middleware instanceof Middleware) {\r\n                                middlewareGroups.push(middleware)\r\n                                return\r\n                            }\r\n                            if (Array.isArray(middleware)) {\r\n                                middleware.forEach(subMiddleware => add(subMiddleware))\r\n                                return\r\n                            }\r\n                            if ('after' in middleware) {\r\n                                add(middleware.after)\r\n                            }\r\n                        }\r\n                        add(route.meta.middleware)\r\n                    }\r\n                })\r\n                middlewareGroups.push(...this.afterDefault.slice(0))\r\n                if (middlewareGroups.length) {\r\n                    (new AfterMiddlewareManager(middlewareGroups, this)).run(to, from)\r\n                }\r\n            }\r\n\r\n            session.skipping() && session.abortSkipping()\r\n            this.afterRouting && this.afterRouting(to, from)\r\n        })\r\n    }\r\n\r\n    parseRoute(route, parentPath = '') {\r\n        const routePath = '/' + (parentPath + '/' + route.path).replace(/\\/+/g, '/').replace(/^\\/|\\/$/g, '')\r\n        if (route.name) {\r\n            this.routePathByNames[route.name] = routePath\r\n        }\r\n        route.children && route.children.length && route.children.forEach(childRoute => {\r\n            this.parseRoute(childRoute, routePath)\r\n        })\r\n    }\r\n\r\n    parseRoutes() {\r\n        this.routePathByNames = {}\r\n        this.options.routes.forEach(route => {\r\n            this.parseRoute(route)\r\n        })\r\n    }\r\n\r\n    getPathByName(name) {\r\n        return name in this.routePathByNames ? this.routePathByNames[name] : null\r\n    }\r\n\r\n    replaceRoutes(routes) {\r\n        this.options.routes = routes\r\n        this.matcher = (new Router(this.options)).matcher\r\n\r\n        this.parseRoutes()\r\n\r\n        return this\r\n    }\r\n\r\n    switchToAuth() {\r\n        if (this.authRoutes) {\r\n            this.replaceRoutes(this.authRoutes)\r\n            return true\r\n        }\r\n        return false\r\n    }\r\n\r\n    switchToNotAuth() {\r\n        if (this.notAuthRoutes) {\r\n            this.replaceRoutes(this.notAuthRoutes)\r\n            return true\r\n        }\r\n        return false\r\n    }\r\n\r\n    softReplace(location, onComplete = null, onAbort = null, sessionSkipped = true) {\r\n        sessionSkipped && session.skip()\r\n        return this.smoothReplace(location, onComplete, onAbort)\r\n    }\r\n\r\n    smoothReplace(location, onComplete = null, onAbort = null) {\r\n        return this.replace(location, onComplete, () => {\r\n            onAbort && onAbort()\r\n        })\r\n    }\r\n\r\n    catchSoftReplace(location, onComplete = null, onAbort = null, sessionSkipped = true) {\r\n        sessionSkipped && session.skip()\r\n        return this.replace(location, onComplete, onAbort)\r\n    }\r\n\r\n    softPush(location, onComplete = null, onAbort = null, sessionSkipped = true) {\r\n        sessionSkipped && session.skip()\r\n        return this.smoothPush(location, onComplete, onAbort)\r\n    }\r\n\r\n    smoothPush(location, onComplete = null, onAbort = null) {\r\n        return this.push(location, onComplete, () => {\r\n            onAbort && onAbort()\r\n        })\r\n    }\r\n\r\n    catchSoftPush(location, onComplete = null, onAbort = null, sessionSkipped = true) {\r\n        sessionSkipped && session.skip()\r\n        return this.push(location, onComplete, onAbort)\r\n    }\r\n}\r\n"],"file":"router.js"}